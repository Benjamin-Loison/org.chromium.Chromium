From 9ae1a17ef09e2a25bee13f0211bf92d7a528fe36 Mon Sep 17 00:00:00 2001
From: Ryan Gonzalez <rymg19@gmail.com>
Date: Wed, 26 Aug 2020 20:23:56 -0500
Subject: [PATCH 08/17] Add support for Flatpak's Widevine location

---
 chrome/common/chrome_paths.cc | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/chrome/common/chrome_paths.cc b/chrome/common/chrome_paths.cc
index 8f26e588b4e63..82a33321f5e52 100644
--- a/chrome/common/chrome_paths.cc
+++ b/chrome/common/chrome_paths.cc
@@ -384,6 +384,14 @@ bool PathProvider(int key, base::FilePath* result) {
 #if (defined(OS_LINUX) || defined(OS_CHROMEOS)) && \
     BUILDFLAG(BUNDLE_WIDEVINE_CDM)
     case chrome::DIR_BUNDLED_WIDEVINE_CDM:
+      if (sandbox::FlatpakSandbox::GetInstance()->GetSandboxLevel() >
+          sandbox::FlatpakSandbox::SandboxLevel::kNone) {
+        cur = base::FilePath(
+            FILE_PATH_LITERAL("/app/widevine/libwidevinecdm.so"));
+        if (base::PathExists(cur)) {
+          break;
+        }
+      }
       if (!GetComponentDirectory(&cur))
         return false;
 #if !defined(OS_CHROMEOS)
-- 
2.26.2

